import{f as e,a6 as a,z as l,p as t,j as n,a as s,b as o,c as u,w as i,u as r,i as c,r as m,o as d,d as p,l as v,t as T,F as f,k as _,a0 as h,y as D,a4 as b,e as k,_ as $}from"./index-7o_nj4vT.js";import{B as E}from"./chunk-BM2zwdFa.js";import{l as y}from"./chunk-BWAGYGEV.js";const Y={class:"container"},A={class:"mb_2"},w={class:"mb_2"},U={class:"d_flex content_between"},C="YYYY-ww",N=$({__name:"curriculum",setup($){const N=c("dayjs"),g=e(`${N().year()}-34`),O={teacher:"",course:"",weeks:[],classTime:[],room:"",alarm:30},I={name:"",startTime:"08:00",endTime:"09:00"},M=[{name:"第一节",startTime:"08:00",endTime:"09:35"},{name:"第二节",startTime:"10:05",endTime:"11:40"},{name:"第三节",startTime:"14:00",endTime:"15:35"},{name:"第四节",startTime:"16:05",endTime:"17:40"},{name:"第五节",startTime:"19:00",endTime:"20:35"},{name:"第六节",startTime:"20:45",endTime:"22:20"},{name:"午间",startTime:"12:00",endTime:"13:35"},{name:"晚间",startTime:"18:00",endTime:"18:45"}],R=a("joy-curriculum-list",[y.cloneDeep(O)]),S=a("joy-curriculum-class",y.cloneDeep(M)),H=Array.from({length:53},((e,a)=>({label:`第${a+1}周`,value:a+1}))),L=[{label:"无提醒",value:0},{label:"五分钟前",value:5},{label:"十分钟前",value:10},{label:"十五分钟前",value:15},{label:"二十分钟前",value:20},{label:"半小时前",value:30},{label:"一小时前",value:60}],x=["周一","周二","周三","周四","周五","周六","周日"],j=l((()=>x.map(((e,a)=>({label:e,value:a,children:S.value.map(((e,a)=>({label:`${e.name} (${e.startTime}-${e.endTime})`,value:a})))}))))),F=t({visible:!1,list:[]}),V=e(R.value.map(((e,a)=>a))),G=()=>`BEGIN:VCALENDAR\nPRODID:-//YangH9//China Calendar//CN\nVERSION:2.0\nCALSCALE:GREGORIAN\nMETHOD:PUBLISH\nX-WR-CALNAME:课程表日历\nX-WR-TIMEZONE:Asia/Shanghai\nX-WR-CALDESC:${g.value}周课程表日历\nBEGIN:VTIMEZONE\nTZID:Asia/Shanghai\nX-LIC-LOCATION:Asia/Shanghai\nBEGIN:STANDARD\nTZOFFSETFROM:+0800\nTZOFFSETTO:+0800\nTZNAME:CST\nDTSTART:19700101T000000\nEND:STANDARD\nEND:VTIMEZONE\n`,B=({start:e,end:a,UID:l,create:t,modify:n,summary:s,location:o,description:u,alarm:i})=>`BEGIN:VEVENT\n${e}${a}${l}${t}${n}${s}${o}${u}${i}END:VEVENT\n`,P=()=>"END:VCALENDAR",Z=()=>{const e=R.value.filter((e=>2===e.classTime.length)).map(((e,a)=>{const{name:l,startTime:t,endTime:n}=S.value[e.classTime[1]]||{},s=e.classTime[0];return e.weeks.map((o=>{const u=N(N(g.value,C).diff(N.duration({weeks:-o,days:-s}))),i={start:`DTSTART:${N(`${u.format("YYYY-MM-DD")} ${t}`).format("YYYYMMDDTHHmm00")}\n`,end:`DTEND:${N(`${u.format("YYYY-MM-DD")} ${n}`).format("YYYYMMDDTHHmm00")}\n`,UID:`UID:${u.format("YYYYMMDDTHHmm01")}_${a+1}@YangH9\n`,create:`CREATED:${u.format("YYYYMMDDTHHmm01")}\n`,modify:`LAST-MODIFIED:${N().format("YYYYMMDDTHHmmss")}\n`,summary:`SUMMARY:『${e.course}』${H[o-1].label}\n`,location:`LOCATION:${e.room}\n`,description:`DESCRIPTION:课程名称：『${e.course}』${H[o-1].label}\\n上课时间：${x[s]} ${l}(${t}-${n})\\n授课老师：${e.teacher}\\n教室位置：${e.room}\n`,alarm:e.alarm?`BEGIN:VALARM\nTRIGGER:-PT${e.alarm}M\nACTION:DISPLAY\nEND:VALARM\n`:""};return B(i)})).join("")})).join(""),a=`${g.value}周课程表.ics`,l=`${G()}${e}${P()}`,t=document.createElement("a"),n=new Blob([l]);t.download=a,t.href=URL.createObjectURL(n),t.click(),URL.revokeObjectURL(n)},q=e([]),W=e=>(q.value=[e],X(e).catch((e=>{b.warning("文件数据异常")})),!1),X=e=>new Promise(((a,l)=>{const t=new FileReader;t.onload=e=>{const t=e.target.result;if(!t.startsWith("<html"))return void l("不支持该文件类型");const n=[];(new DOMParser).parseFromString(t,"text/html").querySelector("table tbody").querySelectorAll("tr").forEach(((e,a)=>{e.querySelectorAll("td").forEach(((e,l)=>{if(e.innerText&&l){const t=/([\u4e00-\u9fa5\w（）]+?)\(.*?\).*?\((.*?)\).*?\(([\u4e00-\u9fa5]?)(\d+)-(\d+),.*?(.*?)\)/g;[...e.innerText.matchAll(t)].forEach((e=>{n.push({teacher:e[2],course:e[1],weeks:H.slice(e[4]-1,e[5]).filter((a=>e[3]?"双"===e[3]&&!(a.value%2)||"单"===e[3]&&a.value%2:!e[3])).map((e=>e.value)),classTime:[l-1,a],room:e[6],alarm:30})}))}}))})),R.value=n.sort(((e,a)=>e.classTime[0]===a.classTime[0]?e.classTime[1]-a.classTime[1]:e.classTime[0]-a.classTime[0])),V.value=n.map(((e,a)=>a)),a()},t.readAsText(e,"GB2312")}));return(e,a)=>{const l=m("a-date-picker"),t=m("aSettingOutlined"),c=m("a-button"),b=m("aUploadOutlined"),$=m("a-upload"),N=m("a-menu"),x=m("aDownOutlined"),G=m("a-dropdown"),B=m("aDownloadOutlined"),P=m("aPlusOutlined"),X=m("aUndoOutlined"),K=m("aDeleteOutlined"),z=m("a-input"),J=m("a-form-item"),Q=m("a-descriptions-item"),ee=m("a-cascader"),ae=m("a-select-option"),le=m("a-select"),te=m("a-descriptions"),ne=m("a-form"),se=m("a-collapse-panel"),oe=m("a-collapse"),ue=m("a-card"),ie=m("a-time-picker"),re=m("a-modal"),ce=k("calcHeight");return d(),n("div",Y,[s(E,{overlayShow:""}),o((d(),u(ue,{class:"flow_hidden",title:"课程表日程生成器",hoverable:!0},{extra:i((()=>[s(l,{value:g.value,"onUpdate:value":a[0]||(a[0]=e=>g.value=e),valueFormat:C,placeholder:"第一周时间",picker:"week",class:"mr_2"},null,8,["value"]),s(G,{overlayStyle:{zIndex:1e3}},{overlay:i((()=>[s(N,{class:"p_2"},{default:i((()=>[p("div",A,[s(c,{block:"",onClick:a[1]||(a[1]=()=>{F.visible=!0,F.list=r(y.cloneDeep)(r(S))})},{default:i((()=>[s(t),v(" 课程时间 ")])),_:1})]),p("div",w,[s($,{accept:".xls,.xlsx","file-list":q.value,"before-upload":W,showUploadList:!1},{default:i((()=>[s(c,{block:""},{default:i((()=>{var e;return[s(b),v(" "+T((null==(e=q.value[0])?void 0:e.name)||"导入文件"),1)]})),_:1})])),_:1},8,["file-list"])])])),_:1})])),default:i((()=>[s(c,{class:"mr_2"},{default:i((()=>[v(" 更多操作 "),s(x)])),_:1})])),_:1}),s(c,{type:"primary",onClick:Z},{default:i((()=>[s(B),v(" 生成日程 ")])),_:1})])),default:i((()=>[s(oe,{activeKey:V.value,"onUpdate:activeKey":a[2]||(a[2]=e=>V.value=e)},{default:i((()=>[(d(!0),n(f,null,_(r(R),((e,a)=>(d(),u(se,{key:a,header:`课程${a+1}`},{extra:i((()=>[s(c,{type:"link",class:"mr_2",onClick:h((()=>r(R).splice(a+1,0,r(y.cloneDeep)(O))&V.value.push(r(R).length-1)),["stop"])},{icon:i((()=>[s(P)])),_:2},1032,["onClick"]),s(c,{type:"link",class:"mr_2",onClick:h((()=>r(R).splice(a,1,r(y.cloneDeep)(O))),["stop"])},{icon:i((()=>[s(X)])),_:2},1032,["onClick"]),r(R).length>1?(d(),u(c,{key:0,type:"link",danger:"",onClick:h((()=>r(R).splice(a,1)),["stop"])},{icon:i((()=>[s(K)])),_:2},1032,["onClick"])):D("",!0)])),default:i((()=>[s(ne,null,{default:i((()=>[s(te,{class:"mb_2"},{default:i((()=>[s(Q,null,{default:i((()=>[s(J,{label:"课程",class:"mb_0 grow"},{default:i((()=>[s(z,{value:e.course,"onUpdate:value":a=>e.course=a,placeholder:"课程"},null,8,["value","onUpdate:value"])])),_:2},1024)])),_:2},1024),s(Q,null,{default:i((()=>[s(J,{label:"教室",class:"mb_0 grow"},{default:i((()=>[s(z,{value:e.room,"onUpdate:value":a=>e.room=a,placeholder:"教室"},null,8,["value","onUpdate:value"])])),_:2},1024)])),_:2},1024),s(Q,null,{default:i((()=>[s(J,{label:"老师",class:"mb_0 grow"},{default:i((()=>[s(z,{value:e.teacher,"onUpdate:value":a=>e.teacher=a,placeholder:"老师"},null,8,["value","onUpdate:value"])])),_:2},1024)])),_:2},1024),s(Q,null,{default:i((()=>[s(J,{label:"时间",required:"",class:"mb_0 grow"},{default:i((()=>[s(ee,{value:e.classTime,"onUpdate:value":a=>e.classTime=a,options:j.value,"expand-trigger":"hover",placeholder:"上课时间",popupClassName:"h240"},null,8,["value","onUpdate:value","options"])])),_:2},1024)])),_:2},1024),s(Q,null,{default:i((()=>[s(J,{label:"上课周",class:"mb_0 grow"},{default:i((()=>[s(le,{value:e.weeks,"onUpdate:value":a=>e.weeks=a,mode:"multiple",allowClear:"","max-tag-count":"responsive",placeholder:"上课周"},{default:i((()=>[(d(!0),n(f,null,_(r(H),((e,a)=>(d(),u(ae,{key:a,value:e.value},{default:i((()=>[v(T(e.label),1)])),_:2},1032,["value"])))),128))])),_:2},1032,["value","onUpdate:value"])])),_:2},1024)])),_:2},1024),s(Q,null,{default:i((()=>[s(J,{label:"提醒",class:"mb_0 grow"},{default:i((()=>[s(le,{value:e.alarm,"onUpdate:value":a=>e.alarm=a,placeholder:"提醒时间"},{default:i((()=>[(d(),n(f,null,_(L,((e,a)=>s(ae,{key:a,value:e.value},{default:i((()=>[v(T(e.label),1)])),_:2},1032,["value"]))),64))])),_:2},1032,["value","onUpdate:value"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["header"])))),128))])),_:1},8,["activeKey"])])),_:1})),[[ce,{height:21,dom:".ant-card-body"}]]),s(re,{open:F.visible,"onUpdate:open":a[4]||(a[4]=e=>F.visible=e),width:"1000px",closable:!1,bodyStyle:{maxHeight:"calc(100vh - 300px)",overflowY:"auto"},onOk:a[5]||(a[5]=()=>{F.visible=!1,S.value=r(y.cloneDeep)(F.list)})},{title:i((()=>[p("div",U,[v(" 课程时间 "),s(c,{type:"link",onClick:a[3]||(a[3]=()=>F.list=r(y.cloneDeep)(M))},{default:i((()=>[s(X),v(" 重置 ")])),_:1})])])),default:i((()=>[(d(!0),n(f,null,_(F.list,((e,a)=>(d(),u(te,{key:a,column:4,class:"mb_2"},{default:i((()=>[s(Q,null,{default:i((()=>[s(z,{value:e.name,"onUpdate:value":a=>e.name=a,placeholder:"名称"},null,8,["value","onUpdate:value"])])),_:2},1024),s(Q,null,{default:i((()=>[s(ie,{value:e.startTime,"onUpdate:value":a=>e.startTime=a,format:"HH:mm","value-format":"HH:mm",class:"w_100",placeholder:"上课时间"},null,8,["value","onUpdate:value"])])),_:2},1024),s(Q,null,{default:i((()=>[s(ie,{value:e.endTime,"onUpdate:value":a=>e.endTime=a,format:"HH:mm","value-format":"HH:mm",class:"w_100",placeholder:"上课时间"},null,8,["value","onUpdate:value"])])),_:2},1024),s(Q,null,{default:i((()=>[s(c,{type:"link",onClick:h((()=>F.list.splice(a+1,0,r(y.cloneDeep)(I))),["stop"])},{icon:i((()=>[s(P)])),_:2},1032,["onClick"]),F.list.length>1?(d(),u(c,{key:0,type:"link",danger:"",onClick:h((()=>F.list.splice(a,1)),["stop"])},{icon:i((()=>[s(K)])),_:2},1032,["onClick"])):D("",!0)])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["open"])])}}},[["__scopeId","data-v-c68ed2c1"]]);export{N as default};
